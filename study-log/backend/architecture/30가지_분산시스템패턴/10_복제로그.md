# 목적
- 클러스터의 모든 노드가 동일한 요청을 동일한 순서로 실행하도록 보장해, 전체 시스템이 일관된 상태를 유지하기 위함

# 개요
- 과반수 정족수 합의는 원래 2단계가 필요하지만, 리더를 선출하면 이후에는 1단계만으로 합의 가능
  - 매번 세대 시계 확정, 이전 과반수 정족수 노드의 복제 로그 알아내서, 클러스터 전체에 전파 비효율
  - 리더는 로그 복제를 조정하고, 과반수에 복제되면 합의 성립
- 대부분 시스템은 죽는 결함(Crash Fault) 을 가정 → Raft, Paxos 사용
- 비잔틴 결함을 허용해야 하면 PBFT라는 알고리즘 사용 (3단계, 3*실패허용횟수+1 노드 필요)
  - 노드가 죽는 것에 끝나지 않고 다른 영향이 나타나거나 시스템 컴포넌트의 실패 여부조차 불확실할 수 있는 상태
 
# 복제 로그 매커니즘 예시 - Raft
- 클라이언트 요청 복제
- 완전 복제
- 리더 선출
- 이전 세대 로그 엔트리

# 복제 로그 매커니즘 기술적 고려사항
- 합의의 첫 단계에서는 **이전 과반수에 복제됐을 수 있는 로그 엔트리를 복구**해야 한다.
  * Raft는 **최신 로그를 가진 노드를 리더로 선출**해 추가 전송을 최소화한다.
  * 충돌 로그는 **커밋되지 않았으므로 안전하게 덮어씀**.
- **뒤처지거나 재시작한 노드**를 위해 리더는 누락된 로그를 모두 전송한다.
  * Raft는 노드별 복제 인덱스를 추적해 필요한 엔트리를 보낸다.
- 클라이언트는 **리더에게만 요청**하며, 리더가 순서를 정하고 과반수 복제 후 실행한다.
  * **중복 요청은 멱등 처리**로 방지한다.
* 로그는 **스냅샷 기반으로 압축**하며, 느린 노드에는 전체 로그 대신 스냅샷을 전송한다.
* 모든 요청이 전역적으로 정렬될 필요는 없다.
  * 키·파티션별 합의(E-Paxos, MongoDB 등)를 사용하면 **병렬성과 확장성**을 높일 수 있다.
