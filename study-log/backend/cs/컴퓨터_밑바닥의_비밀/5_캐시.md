# 캐시
- 레지스터, L1/L2/L3 캐시, 메모리, 디스크, 분산파일시스템
- CPU는 가상메모리로 접근한다.

# 멀티코어(CPU)간 불일치 문제
- write-through
  - 캐시 갱신 시 메모리 함께 업데이트
- write-back
  - write-through를 비동기로 수행
  - 캐시에서 eviction시 메모리 갱신
- 멀티코어에서는 MESI protocol과 같은 일관성 유지 규칙 존재

 # 캐시 친화적 프로그래밍
- 무작정 개선하기전에 성능분석 도구로 캐시 적중률이 병목이 되는 것이 확인되면 적중률 개선 
- 지역성
  - 인접한 메모리 참조
  - malloc으로 매번 할당받으면 힙내에서 매번 랜덤한 위치에서 받아옴
  - 미리 큰 조각을 할당해놓는 메모리풀 활용
- 자료구조의 특성
  - 배열은 참조할 땐 지역성 좋지만, 빈번한 수정/삭제 시에는 연결리스트가 우수
 
# 다중 스레드 성능방해자로서의 캐시 미스
- 캐시라인
  - 캐시와 메모리 상호작용 단위
  - 지역성 활용을 위해 묶어서 관리
- 캐시 튕김
  - 다중 스레드에서 캐시 일관성 보장을 위해 다른 코어의 캐시를 무효화하며 캐시 적중률 저하
- 거짓 공유
  - 실제로는 스레드간 공유변수 없으나 동일한 캐시라인에 각 변수들이 존재함에 따라, 덩달아 캐시 미스남


# 명령어의 비순차적 실행
- 비순차적 요소
  - 컴파일러에서 명령어 재정렬
    - volitile로 컴파일러를 막을 수 있음
  - CPU에서 실행 중 마가 뜨면 다른 명령어 실행(OoDE)
    - Out of Order Execution
      - 모든 CPU에 있는 기능을 아님
      - 피연산자 로드되는 동안 다른 명령어 수행
      - 이전 명령어 실행결과 기다렸다가 이미 결과 나온 현재 실행결과 나중에 기록
- 캐시랑 코어 사이에 버퍼도 있음(캐시도 바로 갱신되지도 않음)
- 메모리장벽
  - 어떤 코어가 명령어를 실행하는 순서와 다른 코어에서 보이는 순서가 코드와 일치하도록 하기위한 코드
  - 단일 스레드/멀티스레드 잠금없는 프로그래밍을 사용할 필요없으면 고려 안 해도 됨
