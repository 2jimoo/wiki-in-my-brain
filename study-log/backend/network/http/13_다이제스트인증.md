# 다이제스트 인증의 개선점
- 비밀번호를 평문으로 보내진 않는다
- 인증을 가로채는 재현 공격 방지
- 메세지 위변조 방지 가능

# 다이제스트 인증
- 컨셉
  - 비밀번호를 단방향 해시함수(ex. MD5)로 비가역적으로 섞은 fingerprint/digest 전송
  - 클라이언트와 서버는 비밀번호에 digest가 대응하는지 검증 
  - 잘 안쓰임, 보통 SSL사용
- Nonce
  - 재전송 공격 방지 
  - 자주 바뀌는 값, 특정 난스에 대해서만 비밀번호 다이제스트 유효
- 핸드셰이크 과정
  - WWW-Authenticate(인증요구)
    - 서버가 클라이언트에게 realm(보안 영역), 난스, 알고리즘 전달
  - Authrization(응답)
    - 클라이언트가 알고리즘 선택해서 클라이언트 난스, 다이제스트 생성해서 전달
    - 서버 측에서 다이제스트 검증, 다음 난스 생성, 클라이언트 난스 써서 서버 다이제스트 생성(rspauth)
  - Authentication-Info(정보)
    - 서버가 다음 난스, rspauth 전송
    - 클라이언트 rspauth 검증
- 다이제스트 세션
  - 해당 realm의 다른 서버로부터 WWW-Authenticate 받을 때까지 지속
  - 오래된 Authrization 허용하거나, 비밀번호 재입력없이 새 난스로 대답하도록 stale=true 설정과 함께 401응답 가능 
   
# 다이제스트
- 공개된 정보, 비밀 정보, 시한부 난스 값을 조합한 단방향 요약
- 보안 관련 데이터
  - A1로 불림, 사용자 이름/비밀번호/보호영역/난스 등의 비밀정보로 구성
  - 알고리즘 별로 다름
- 메세지 관련 데이터
  - A2로 불림, URL/요청 메서드/메시지 엔티티 본문 등 메세지 자체 정보로 구성
 
# 사전(preemptive)인가
- 클라이언트가 다음 난스를 미리 알 수 있어서 Authorization을 요청없이 응답
  - Authentication-Info에서 전달
    - 다음 요청 전에 반드시 응답 받아야해서 파이프라이닝X, 성능 불이익
  - 재사용 허용
    - 재전송 공격 보안상 별로
  - 같은 알고리즘 사용
    - 공유된 비밀키 기반 같은 순차로 난스 생성 가능하도록, 시간적으로 동기화된 난스 생성 알고리즘 
    - 타임스탬프, 개인키, Etag(갱신된 리소스에 대한 재요청 방지)

# 상호 인증
- A2만 다르고 방식은 동일

# 보호수준(Quality of Protection) 향상
- qop
  - 클라이언트와 서버가 어떤 보호기법을 어느정도 수준으로 사용할 것인지 조정하는데 사용하는 필드
  - ex. 메시지 무결성 보호 qop="auth-int"
- 다중 인증 요구
  - 서버가 한 리소스에 대해 여러 인증 요구
  - 클라이언트가 기본 인증 선택할 수도. 기본인증은 최대한 제한적으로 사용
- 오류 처리
  - 400, 실패 기록(반복된 실패-비밀번호 추측 시도 가능성)
- 보호공간
  - realm은 root url과 결합되어 보호공간 정의
  - 영역 별 인증/인가 데이터 및 방법 관리

# 캐시
- 어떤 공유캐시가 Authorization요청 및 응답을 받은 경우, 두 Cache-Control 지시자 중 하나가 있어야 반환해도 안전함
  - must-revalidate: 그 응답의 엔티티를 다음 요청의 응답에 활용, 반드시 재검사
  - public: 반환 허용

# 보안 고려사항
- 데이터까지 보호하는 것은 아님(인증임)
- 헤더 부당 변경
  - 암호화, 헤더 디지털 서명 필요
  - 진정한 보안 트랜잭션은 SSL통해서만 가능
- 재전송 공격
  - 같은 난스 허용하지 않도록 함
  - IP를 속이거나 IP공유하는 프록시팜은 대응X
- 다중 인증
  - 인증 가능한 방법이 여러 개일때 반드시 클라이언트가 강한 방법 선택할 의무X
- dictionary 공격, 무차별 대입 공격
  - 단순한 난스, 비밀번호의 경우 다 시도해보기 가능
  - 강한 비밀번호 정책/만료 매커니즘 필요
- 악의적인 프락시와 중간자 공격, 선택 평문 공격
  - 프록시가 난스를 제공하거나 빼돌리는 역할
  - dictionary를 구축한 뒤 서버인척 클라이언트에게 난스 전송해봐서 되는거 있으면 비밀번호 탈취 가능
- 비밀번호 파일 탈취
  - 피해 특정 영역으로 국소화  
