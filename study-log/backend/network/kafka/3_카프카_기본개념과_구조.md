# 구성요소
- 브로커(노드)
- 토픽
- 파티션
- 세그먼트
  - 실제 메시지가 로컬리스트에 저장되는 파일
- 메시지(레코드)
  - 데이터 전송 단위

# 리플리케이션
- 메세지를 복제해서 카프카 클러스터 내 브로커들에 분산
- 리플리케이션 팩터 수: 유실 허용도에 따라서.

# 파티션
- 파티션 수만큼 컨슈머 연결
- 파티션 수 늘리는 건 용이하나 줄이기는 불가함
  - 메세지 처리량이나 컨슈머의 LAG 등을 모니터링하면서 늘려감

# 분산시스템
- 성능, 장애 대응, 시스템 확장성
- 성능
  - 페이지 캐시: 운영체제에서 직접 디스크에 쓰지 않고, 애플리케이션에서 사용하지 않는 일부 잔여메모리 활용
  - 배치 전송 + 압축 전송
  - 토픽(주소), 파티션(병렬처리), 오프셋(단조증가 64비트)
- 고가용성
  - 리플리케이션: 토픽 말고 파티션 복제
  - 주키퍼 앙상블(클러스터)
    - znode에 카프카 메타정보 기록. 노드/토픽/컨트롤러 등 관리
   
# 프로듀서
1. 레코드 구성
   - 토픽, 파티션, 키, 밸류
2. producer.send()
   - 시리얼라이저, 파티셔너(키 없으면 라운드 로빈)
3. 재시도/응답
   - 배치 전송, 재시도, 최종실패 or 메타데이터 응답
  
# 컨슈머
- 컨슈머 그룹이 토픽에 요청
- 파티션과 컨슈머 일대일 매핑
  - 컨슈머가 더 많아봤자 놀기만 함
  - 리밸런싱으로 알아서 장애 대응됨 
